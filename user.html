
<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | WASI OTP</title>
    
    <!-- Scripts & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Public+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { primary: '#0061ff' } } }
        }
    </script>

    <style>
        /* 1. AUTH GUARD - CONTENT HIDE */
        html { display: none; } 
        
        body { font-family: 'Public Sans', sans-serif; background-color: #f4f6f9; transition: all 0.3s ease; overflow-x: hidden; }
        .font-brand { font-family: 'Montserrat', sans-serif; }

        /* 2. FAST EYE LOADER */
        .loader-wrap { position: fixed; inset: 0; background: #fff; z-index: 100000; display: flex; align-items: center; justify-content: center; }
        .loader-eye { position: relative; width: 78px; height: 78px; border-radius: 50%; background: #fff; border: 8px solid #131a1d; overflow: hidden; }
        .loader-eye::after { content: ''; position: absolute; left: 0; top: -50%; width: 100%; height: 100%; background: #263238; z-index: 5; border-bottom: 8px solid #131a1d; animation: eyeShade 1.5s infinite; }
        .loader-eye::before { content: ''; position: absolute; left: 20px; bottom: 15px; width: 32px; height: 32px; background: #111; border-radius: 50%; animation: eyeMove 1.5s infinite; z-index: 2; }
        @keyframes eyeShade { 0%, 100% { transform: translateY(0) } 50% { transform: translateY(10px) } }
        @keyframes eyeMove { 0%, 100% { transform: translate(0,0) } 50% { transform: translate(-10px, -5px) } }
        .loader-hidden { opacity: 0; visibility: hidden; transition: 0.5s; }

        /* 3. HERO BOX & BUBBLES */
        .hero-box { 
            background: linear-gradient(to right, #60a5fa 0%, #0061ff 100%); 
            border-radius: 0px !important; position: relative; overflow: hidden; height: 180px;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .hero-box::after {
            content: ''; position: absolute; right: -40px; top: 0; width: 55%; height: 100%;
            background-color: #0055ff; border-radius: 100% 0 0 100%; z-index: 1;
        }
        .bubble { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.15); z-index: 2; }
        .b1 { width: 18px; height: 18px; right: 95px; bottom: 45px; border: 1px solid rgba(255,255,255,0.2); }
        .b2 { width: 10px; height: 10px; right: 135px; bottom: 65px; }
        .b3 { width: 50px; height: 50px; right: 15px; bottom: -15px; background: rgba(255, 255, 255, 0.05); }

        /* 4. MARQUEE (YOUR EXACT CODE) */
        .marquee-container { background-color: #0000ff; color: white; height: 28px; display: flex; align-items: center; overflow: hidden; }

        /* 5. BLACK SIDEBAR STYLING */
        #sidebar { background-color: #ffffff; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-open #sidebar { transform: translateX(0); }
        .sidebar-heading { font-size: 11px; font-weight: 900; color: #000; text-transform: uppercase; letter-spacing: 1.5px; margin-top: 25px; padding: 10px; border-bottom: 2px solid #f1f5f9; }
        .sidebar-link { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 10px; color: #000 !important; font-weight: 800; font-size: 13px; }
        .sidebar-link i { color: #000 !important; width: 22px; text-align: center; font-size: 16px; }
        .sidebar-link:hover { background-color: #f8fafc; color: #0061ff !important; }

        /* 6. COMPACT GRID BUTTONS */
        .grid-btn { background-color: #0061ff; color: white; padding: 10px 0; border-radius: 6px; font-size: 11px; text-align: center; font-weight: 500; text-transform: uppercase; font-style: normal !important; }

        /* 7. SUMMARY CARDS */
        .summary-item { background: white; border: 1px solid #edf2f7; padding: 14px; border-radius: 10px; margin-bottom: 8px; display: flex; align-items: center; justify-content: space-between; }
        
        .dark body { background-color: #0f172a; color: white; }
        #toast { visibility: hidden; min-width: 250px; background: #1f2937; color: #fff; text-align: center; border-radius: 12px; padding: 14px; position: fixed; z-index: 99999; left: 50%; bottom: 30px; transform: translateX(-50%); font-weight: 700; }
        #toast.show { visibility: visible; }
    </style>
</head>
<body class="min-h-screen">

    <!-- EYE LOADER -->
    <div id="wasi-loader-eye" class="loader-wrap">
        <div class="loader-eye"></div>
    </div>

    <div id="toast"></div>

    <!-- Top Navbar -->
    <nav class="bg-white dark:bg-slate-900 border-b border-gray-200 dark:border-slate-800 px-4 py-3 sticky top-0 z-50 shadow-sm flex justify-between items-center">
        <div class="flex items-center gap-4">
            <button onclick="toggleSidebar()" class="w-9 h-9 bg-gray-50 dark:bg-slate-800 rounded flex items-center justify-center text-gray-500 shadow-inner"><i class="fas fa-bars"></i></button>
            <span class="text-[17px] font-extrabold text-blue-600 font-brand uppercase italic">WASI OTP</span>
        </div>
        <div class="flex items-center gap-2">
            <!-- Global Multi-Currency Switcher -->
            <div onclick="toggleCurrency()" class="border border-gray-300 dark:border-slate-700 rounded-full px-3 py-1.5 flex items-center gap-2 bg-white dark:bg-slate-800 cursor-pointer hover:bg-gray-50 transition-all text-slate-800 dark:text-white">
                <span id="top-balance" class="text-[14px] font-bold tracking-tighter">0.00</span> 
                <span id="currency-label" class="text-[10px] font-black text-blue-600 uppercase border-l pl-2">PKR</span>
            </div>
            <button onclick="toggleTheme()" class="w-10 h-10 flex items-center justify-center text-gray-400 text-lg transition-all active:scale-90"><i id="theme-icon" class="fas fa-moon"></i></button>
            <img src="0d3b68a111a3a08a5f8996e83aeeeba2.jpg" class="w-10 h-10 rounded-full border-2 border-primary object-cover shadow-sm">
        </div>
    </nav>

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/40 z-[60] hidden"></div>
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-72 bg-white dark:bg-slate-900 z-[70] -translate-x-full border-r border-gray-200 dark:border-slate-800 p-6 shadow-2xl transition-transform overflow-y-auto">
        <div class="flex items-center gap-2 mb-8 p-2">
            <div class="bg-primary p-2 rounded-lg text-white shadow-lg"><i class="fas fa-sms text-xl"></i></div>
            <span class="text-2xl font-black uppercase text-blue-600 font-brand italic">WASI MASTER</span>
        </div>
        <nav>
            <div class="sidebar-heading font-black">Main Menu</div>
            <a href="user" class="sidebar-link"><i class="fas fa-home"></i> Home Dashboard</a>
            
            <div class="sidebar-heading font-black">Number Activations</div>
            <a href="server1" class="sidebar-link"><i class="fas fa-server"></i> Server 01</a>
            <a href="server3" class="sidebar-link text-red-600"><i class="fas fa-bolt"></i> Server 03</a>
            <a href="server4" class="sidebar-link text-cyan-600"><i class="fas fa-microchip"></i> Server 04</a>
            
            <div class="sidebar-heading font-black">Billing & History</div>
            <a href="deposit" class="sidebar-link"><i class="fas fa-wallet"></i> Recharge Wallet</a>
            <a href="history" class="sidebar-link"><i class="fas fa-history"></i> My History</a>
            <a href="promo" class="sidebar-link"><i class="fas fa-gift"></i> Redeem Promo</a>

            <div class="sidebar-heading font-black">Support & Info</div>
            <a href="howtouse" class="sidebar-link"><i class="fas fa-play-circle"></i> Tutorial Video</a>
            <a href="term" class="sidebar-link"><i class="fas fa-file-contract"></i> Terms Policy</a>
            
            <button onclick="logout()" class="sidebar-link text-red-600 mt-10 w-full font-bold uppercase"><i class="fas fa-power-off"></i> Logout Account</button>
        </nav>
    </aside>

    <main class="container mx-auto px-4 py-6 max-w-2xl">
        <p class="text-[12px] text-gray-500 dark:text-gray-400 mb-4 font-normal uppercase tracking-widest italic">Dashboard / <span class="font-medium text-slate-800 dark:text-white uppercase">Main</span></p>

        <!-- HERO CARD (SHARP + BUBBLES + ICONS) -->
        <div class="hero-box p-8 text-white mb-6 shadow-xl">
            <div class="bubble b1"></div><div class="bubble b2"></div><div class="bubble b3"></div>
            
            <div class="flex justify-between items-start z-10 relative">
                <span class="text-[18px] font-normal tracking-wide">Welcome:</span>
                <span id="user-name-display" class="text-[18px] font-bold tracking-tight uppercase italic text-right">...</span>
            </div>
            
            <div class="flex items-end justify-between z-10 relative">
                <div class="balance-sub-box">
                    <span class="text-[14px] font-normal uppercase tracking-widest mb-1 opacity-90 leading-none">Total balance</span>
                    <div class="flex items-center gap-3 mt-1">
                        <span class="text-[26px] font-black italic tracking-tighter leading-none"><span id="curr-sym">Rs</span> <span id="user-balance-display">0.00</span></span>
                        
                        <!-- Double Buttons Connecting to Deposit -->
                        <div class="flex gap-2">
                            <a href="deposit" class="w-8 h-8 bg-white/20 hover:bg-white/40 rounded flex items-center justify-center border border-white/30 transition-all"><i class="fas fa-plus text-[9px]"></i></a>
                            <a href="deposit" class="w-8 h-8 bg-white/20 hover:bg-white/40 rounded flex items-center justify-center border border-white/30 transition-all"><i class="fas fa-shopping-bag text-[9px]"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FITTED MARQUEE (YOUR EXACT CODE) -->
        <div class="marquee-container rounded mb-8 shadow-sm">
            <marquee behavior="scroll" direction="left" scrollamount="6" class="w-full">
                IF SERVERS ARE NOT LOADING COUNTRIRES OR SERVICES TRY ANY VPN WE WILL FIX IT AS SOON AS POSSIBLE THANKS FOR UNDERSTANDING [ REGARDS : TEAM WASIOTP] 
            </marquee>
        </div>

        <!-- Compact Buttons Grid -->
        <h4 class="text-[14px] font-bold text-slate-700 dark:text-gray-300 mb-4 uppercase tracking-widest">Buttons For Quick Actions</h4>
        <div class="grid grid-cols-2 gap-3 mb-10 text-slate-900">
            <a href="server1" class="grid-btn shadow-sm">Server 1</a>
            <a href="server2" class="grid-btn shadow-sm">Server 2</a>
            <a href="server3" class="grid-btn shadow-sm">Server 3</a>
            <a href="server4" class="grid-btn shadow-sm">Server 4</a>
            <a href="deposit" class="grid-btn shadow-sm">Recharge</a>
            <a href="history" class="grid-btn shadow-sm">History</a>
            <a href="promo" class="grid-btn shadow-sm">Promo Code</a>
            <a href="https://cricketbywasi.vercel.app/" class="grid-btn shadow-sm">Download app</a>
            <a href="https://whatsapp.com/channel/0029Vb75PUl4NViorkmONR0T" class="grid-btn shadow-sm">Whatsapp channel</a>
            <a href="services-all" class="grid-btn shadow-sm">prices servers</a>
            <a href="term" class="grid-btn shadow-sm">Term&condition</a>
            <a href="ticket" class="grid-btn shadow-sm">ticket support</a>
            <a href="wa.me/+923342002756" class="grid-btn shadow-sm">Same website order</a>
            
        </div>

        <!-- Summary Section (Lifetime & Bought numbers) -->
        <h4 class="text-[14px] font-bold mb-4 uppercase tracking-widest text-slate-400 italic font-brand">Account Summary</h4>
        <div class="space-y-2 mb-10 text-slate-700 dark:text-gray-300">
            <div class="summary-item shadow-sm border dark:border-slate-700">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-purple-50 dark:bg-purple-900/20 text-purple-600 rounded flex items-center justify-center text-lg shadow-inner"><i class="fas fa-briefcase"></i></div>
                    <div><p class="text-[11px] text-gray-400 font-bold uppercase tracking-widest leading-none">Lifetime Recharged</p><p class="text-[14px] font-bold mt-1">Rs <span id="sum-recharged">0.00</span></p></div>
                </div>
            </div>
            <div class="summary-item shadow-sm border border-l-4 border-l-primary dark:border-slate-700 dark:border-l-blue-600">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-blue-50 dark:bg-blue-900/20 text-blue-600 rounded flex items-center justify-center text-lg shadow-inner"><i class="fas fa-wallet"></i></div>
                    <div><p class="text-[11px] text-gray-400 font-bold uppercase tracking-widest leading-none">Available Balance</p><p class="text-[14px] font-bold text-primary mt-1">Rs <span id="sum-balance">0.00</span></p></div>
                </div>
            </div>
            <div class="summary-item shadow-sm border dark:border-slate-700">
                <div class="flex items-center gap-4">
                    <div class="w-10 h-10 bg-teal-50 dark:bg-teal-900/20 text-teal-600 rounded flex items-center justify-center text-lg shadow-inner"><i class="fas fa-check-circle"></i></div>
                    <div><p class="text-[11px] text-gray-400 font-bold uppercase tracking-widest leading-none">Successful Numbers</p><p id="sum-bought" class="text-[14px] font-bold mt-1">0</p></div>
                </div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="bg-white dark:bg-slate-900 rounded-xl p-5 shadow-sm border border-gray-100 dark:border-slate-800 mb-10">
            <h3 class="text-lg font-black italic uppercase tracking-tighter mb-6 text-slate-700 dark:text-gray-200">Recent Transactions</h3>
            <div class="overflow-x-auto text-[12px]">
                <table class="w-full text-left">
                    <tbody id="transaction-body" class="divide-y divide-gray-100 dark:divide-slate-800 text-slate-700 dark:text-gray-300">
                        <tr><td colspan="3" class="py-10 text-center opacity-30 italic font-bold uppercase">No Logs Found</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Floating Support Button (Left) -->
    <a href="livesupport" target="_blank" class="fixed bottom-6 left-6 bg-primary text-white w-14 h-14 rounded-full shadow-2xl flex items-center justify-center z-[9999] hover:scale-110 transition-all shadow-indigo-200">
        <i class="fas fa-headset text-2xl"></i>
    </a>

    <!-- Floating WhatsApp (Right) -->
    <a href="https://wa.me/923342002756" target="_blank" class="fixed bottom-6 right-6 bg-[#25d366] text-white px-5 py-3 rounded-full shadow-2xl flex items-center gap-2 font-bold z-[9999] hover:scale-105 active:scale-95 transition-all shadow-green-200">
        <i class="fab fa-whatsapp text-2xl"></i> <span class="text-[10px] font-bold uppercase tracking-widest hidden md:block">WhatsApp</span>
    </a>

    <script>
        // --- 1. SUPABASE CONFIG ---
        const SUPABASE_URL = "https://aljcxnobmmtcfpvdacbo.supabase.co";
        const SUPABASE_KEY = "sb_publishable_xVWCkX7Gl2m0cFUKlSn3pg_liSvnzmg";
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentBalancePKR = 0;
        let currencyIndex = 0;
        const currencies = [
            { code: "PKR", symbol: "Rs", rate: 1 },
            { code: "USD", symbol: "$", rate: 0.0035 },
            { code: "EUR", symbol: "€", rate: 0.0032 },
            { code: "INR", symbol: "₹", rate: 0.29 },
            { code: "AED", symbol: "DH", rate: 0.013 },
            { code: "SAR", symbol: "SR", rate: 0.013 },
            { code: "GBP", symbol: "£", rate: 0.0028 }
        ];

        async function init() {
            // Loader Logic (4.5 Seconds)
            setTimeout(() => {
                document.getElementById("wasi-loader-eye").classList.add("loader-hidden");
                setTimeout(() => document.getElementById("wasi-loader-eye").style.display = "none", 800);
            }, 4500);

            // Auth Check
            const { data: { user } } = await _supabase.auth.getUser();
            if (!user) {
                window.location.replace("auth");
            } else {
                document.documentElement.style.display = "block";
                fetchProfile(user.id);
                fetchRecentTransactions(user.id);
            }
        }

        async function fetchProfile(uid) {
            const { data } = await _supabase.from('profiles').select('*').eq('id', uid).single();
            if (data) {
                currentBalancePKR = parseFloat(data.balance || 0);
                document.getElementById('user-name-display').innerText = (data.username || "USER").toUpperCase();
                updateCurrencyUI();
                document.getElementById('sum-recharged').innerText = parseFloat(data.total_recharged || 0).toFixed(2);
                document.getElementById('sum-bought').innerText = data.numbers_bought || 0;
            }
        }

        function updateCurrencyUI() {
            const curr = currencies[currencyIndex];
            const converted = (currentBalancePKR * curr.rate).toFixed(2);
            document.getElementById('top-balance').innerText = converted;
            document.getElementById('currency-label').innerText = curr.code;
            document.getElementById('curr-sym').innerText = curr.symbol;
            document.getElementById('user-balance-display').innerText = converted;
            document.getElementById('sum-balance').innerText = converted;
        }

        function toggleCurrency() {
            currencyIndex = (currencyIndex + 1) % currencies.length;
            updateCurrencyUI();
            showToast("Currency Switched to " + currencies[currencyIndex].code);
        }

        async function fetchRecentTransactions(uid) {
            const { data } = await _supabase.from('deposits').select('*').eq('uid', uid).order('created_at', { ascending: false }).limit(10);
            const tbody = document.getElementById('transaction-body');
            if (data && data.length > 0) {
                tbody.innerHTML = "";
                data.forEach(d => {
                    const sCol = d.status === 'approved' ? 'text-green-500 font-bold' : 'text-orange-500 font-bold';
                    tbody.innerHTML += `<tr class="border-b dark:border-slate-800"><td class="py-4 italic font-medium">Automatic Wallet Recharge</td><td class="py-4 font-bold text-center text-slate-800 dark:text-gray-200">Rs ${parseFloat(d.amount).toFixed(2)}</td><td class="py-4 text-right uppercase ${sCol}">${d.status}</td></tr>`;
                });
            }
        }

        function toggleSidebar() { document.body.classList.toggle('sidebar-open'); document.getElementById('sidebar-overlay').classList.toggle('hidden'); }
        function logout() { _supabase.auth.signOut().then(() => window.location.replace("auth")); }
        function showToast(m) { const x = document.getElementById("toast"); x.innerText = m; x.className = "show"; setTimeout(() => x.className = "", 3000); }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); }
        
        window.onload = init;
    </script>
</body>
</html>
